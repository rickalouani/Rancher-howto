<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>
	Blog | Rancher Labs</title>

<script src="https://use.fontawesome.com/588a89b381.js"></script>

<link rel="profile" href="https://gmpg.org/xfn/11" />
<link rel="pingback" href="https://rancher.com/xmlrpc.php" />
<link rel="shortcut icon" href="https://rancher.com/wp-content/themes/rancher-2016/favicon.ico" />


<!--[if lt IE 9]>
<script src="https://rancher.com/wp-content/themes/rancher-2016/js/html5.js" type="text/javascript"></script>
<![endif]-->


<!-- This site is optimized with the Yoast SEO Premium plugin v4.9 - https://yoast.com/wordpress/plugins/seo/ -->
<link rel="canonical" href="https://rancher.com/blog/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Blog | Rancher Labs" />
<meta property="og:description" content="Rancher Blog" />
<meta property="og:url" content="https://rancher.com/blog/" />
<meta property="og:site_name" content="Rancher Labs" />
<meta property="article:publisher" content="https://www.facebook.com/rancherlabs" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="Rancher Blog" />
<meta name="twitter:title" content="Blog | Rancher Labs" />
<meta name="twitter:site" content="@Rancher_Labs" />
<meta name="twitter:creator" content="@Rancher_Labs" />
<meta property="DC.date.issued" content="2015-02-20T22:50:41+00:00" />
<!-- / Yoast SEO Premium plugin. -->

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Rancher Labs &raquo; Feed" href="https://rancher.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Rancher Labs &raquo; Comments Feed" href="https://rancher.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Rancher Labs &raquo; Blog Comments Feed" href="https://rancher.com/blog/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/rancher.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.5"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='https://rancher.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.8' type='text/css' media='all' />
<link rel='stylesheet' id='toc-screen-css'  href='https://rancher.com/wp-content/plugins/table-of-contents-plus/screen.min.css?ver=1509' type='text/css' media='all' />
<link rel='stylesheet' id='tt-easy-google-fonts-css'  href='https://fonts.googleapis.com/css?family=Open+Sans%3A300&#038;subset=latin%2Call&#038;ver=4.8.5' type='text/css' media='all' />
<link rel='stylesheet' id='app.css-css'  href='https://rancher.com/wp-content/themes/rancher-2016/assets/stylesheets/app.css?ver=2018-03-30-04' type='text/css' media='all' />
<link rel='stylesheet' id='style.css-css'  href='https://rancher.com/wp-content/themes/rancher-2016/style.css?ver=2018-03-30-04' type='text/css' media='all' />
<link rel='stylesheet' id='A2A_SHARE_SAVE-css'  href='https://rancher.com/wp-content/plugins/add-to-any/addtoany.min.css?ver=1.14' type='text/css' media='all' />
<link rel='stylesheet' id='hubspot-css'  href='https://rancher.com/wp-content/plugins/hubspot/css/hubspot.css?ver=4.8.5' type='text/css' media='all' />
<!-- This site uses the Google Analytics by MonsterInsights plugin v6.2.0 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<script type="text/javascript" data-cfasync="false">
	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	var disableStr = 'ga-disable-UA-56382716-3';
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-56382716-3', 'auto');
	__gaTracker('set', 'forceSSL', true);
	__gaTracker('send','pageview');
</script>
<!-- / Google Analytics by MonsterInsights -->
<script type='text/javascript' src='https://rancher.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://rancher.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='https://rancher.com/wp-content/plugins/add-to-any/addtoany.min.js?ver=1.0'></script>
<script type='text/javascript' src='https://rancher.com/wp-content/themes/rancher-2016/assets/js/vendor/vendor.min.js?ver=2018-03-30-04'></script>
<script type='text/javascript' src='https://rancher.com/wp-content/themes/rancher-2016/assets/js/rancher-2016/app.min.js?ver=2018-03-30-04'></script>
<link rel='https://api.w.org/' href='https://rancher.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://rancher.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://rancher.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.5" />
<link rel='shortlink' href='https://rancher.com/?p=13' />
<link rel="alternate" type="application/json+oembed" href="https://rancher.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Francher.com%2Fblog%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://rancher.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Francher.com%2Fblog%2F&#038;format=xml" />

<script type="text/javascript">
var a2a_config=a2a_config||{};a2a_config.callbacks=a2a_config.callbacks||[];a2a_config.templates=a2a_config.templates||{};
</script>
<script type="text/javascript" src="https://static.addtoany.com/menu/page.js" async="async"></script>
		<style type="text/css" id="wp-custom-css">
			
.page-template-template-blog-archive .list-unstyled li, .page-template-template-blog-archive .rnchr-hbspt-form ul li {
    background: #fbfdfc;
    margin: 10px 0 10px 0;
    border: 2px solid #f5f5f5;
    padding-left: 10px !important;
    padding-top: 15px !important;
}
.single .list-unstyled li, .single .rnchr-hbspt-form ul li {
    background: #fbfdfc;
    margin: 10px 0 10px 0;
    border: 2px solid #f5f5f5;
    padding-left: 10px !important;
    padding-top: 15px !important;
}
.page-id-19 .addtoany_content_bottom{display:none !important;}

.rnchr-footer-2 .bg-darkestGrayTwo .row.homepage-newsletters p {
    color: #fff;
    font-size: 1.4em;
    font-weight: 300;
    margin-top: 1px;
}

.rnchr-footer-2 .homepage-footer .nav-copyright p {
    margin: 0;
    color: #fff;
    font-weight: 300;
}		</style>
	<style id="tt-easy-google-font-styles" type="text/css">p { }
h1 { font-family: 'Open Sans'; font-style: normal; font-weight: 300; }
h2 { }
h3 { }
h4 { }
h5 { }
h6 { }
</style><script data-no-minify="1" data-cfasync="false">(function(w,d){function a(){var b=d.createElement("script");b.async=!0;b.src="https://rancher.com/wp-content/plugins/wp-rocket/inc/front/js/lazyload.1.0.5.min.js";var a=d.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)}w.attachEvent?w.attachEvent("onload",a):w.addEventListener("load",a,!1)})(window,document);</script>
<!-- Hotjar Tracking Code for www.rancher.com -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:745525,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>

<body 
  class="page-template page-template-page-templates page-template-template-blog-archive page-template-page-templatestemplate-blog-archive-php page page-id-13"  >


<nav class="nav navbar navbar-inverse navbar-fixed-top ">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src='https://rancher.com/wp-content/themes/rancher-2016/assets/images/rancher-logo-horiz-white.png' class="img-responsive" alt="Rancher">
    </a>
  </div>
  <div id="navbar" class="collapse navbar-collapse">
      <div class="menu-menu-header-container"><ul id="menu-menu-header" class="nav navbar-nav"><li id="menu-item-14127" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-14127 dropdown"><a title="Products" href="#" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true">Products <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-14131" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-14131 dropdown"><a title="Rancher" href="https://rancher.com/rancher/">Rancher</a>
	<ul role="menu" class=" dropdown-menu">
		<li id="menu-item-30856" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30856"><a title="Rancher 2.0" href="https://rancher.com/rancher2-0/">Rancher 2.0</a></li>
		<li id="menu-item-28189" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-28189"><a title="Kubernetes" href="https://rancher.com/kubernetes/">Kubernetes</a></li>
		<li id="menu-item-14137" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14137"><a title="Docker Swarm" href="https://rancher.com/swarm/">Docker Swarm</a></li>
		<li id="menu-item-23346" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-23346"><a title="App Catalog" href="https://rancher.com/catalog-items/">App Catalog</a></li>
	</ul>
</li>
	<li id="menu-item-14132" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14132"><a title="RancherOS" href="https://rancher.com/rancher-os/">RancherOS</a></li>
</ul>
</li>
<li id="menu-item-14128" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-ancestor current-menu-parent menu-item-has-children menu-item-14128 dropdown"><a title="Learn" href="#" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true">Learn <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-14143" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-13 current_page_item menu-item-14143 active"><a title="Blog" href="https://rancher.com/blog/">Blog</a></li>
	<li id="menu-item-14140" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-14140"><a title="Docs - Rancher" href="//rancher.com/docs/rancher/">Docs &#8211; Rancher</a></li>
	<li id="menu-item-21316" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-21316"><a title="Docs - RancherOS" href="//rancher.com/docs/os/">Docs &#8211; RancherOS</a></li>
	<li id="menu-item-14145" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-14145"><a title="Forums" href="//forums.rancher.com">Forums</a></li>
	<li id="menu-item-14141" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14141"><a title="Learning Resources" href="https://rancher.com/learn/">Learning Resources</a></li>
</ul>
</li>
<li id="menu-item-20003" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-20003 dropdown"><a title="About" href="#" data-toggle="dropdown" class="dropdown-toggle" aria-haspopup="true">About <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-14146" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14146"><a title="About Us" href="https://rancher.com/about/">About Us</a></li>
	<li id="menu-item-14147" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14147"><a title="Careers" href="https://rancher.com/careers/">Careers</a></li>
	<li id="menu-item-14148" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14148"><a title="Contact Us" href="https://rancher.com/contact/">Contact Us</a></li>
	<li id="menu-item-14144" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14144"><a title="Events" href="https://rancher.com/events/">Events</a></li>
	<li id="menu-item-14149" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14149"><a title="Partners" href="https://rancher.com/partners/">Partners</a></li>
</ul>
</li>
</ul></div>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://rancher.com/quick-start" id="rnchrdm-nav-download" title="Download Rancher"><i class="fa fa-cloud-download"></i> Download Rancher</a></li>
        <li><a href="https://rancher.com/support" id="rnchrdm-nav-reqsupport" title="Request Support"><i class="fa fa-question-circle-o"></i> Request Support</a></li>
        <li class="search"><a id="rnchr-nav-search-link" title="" ><i class="fa fa-search" aria-hidden="true"></i></a></li>
      </ul>
  </div><!--/.nav-collapse -->
</nav>
<div class="rnchr-nav-search hidden">
  <div class="container">
    <form action="https://rancher.com/search" method="GET" role="search">
      <div class="input-group">
        <input type="search" class="form-control rnchr-nav-search-field" name="q" placeholder="Search rancher.com" autocomplete="off">
      </div>
    </form>
  </div>
</div>
<div class="jumbotron">
  <div class="container" style="position:relative">
    <div class="row">
      <div class="col-xs-12">
        <h1>Rancher Blog</h1>
      </div>
    </div>
  </div>
</div>

<div class="bg-white">
  <div class="container">
    <div class="row top-spacer bottom-spacer">
      <div class="col-sm-10 col-sm-offset-1">
        
        <div class="col-sm-8 blog-archive">
          
             
                                                
                  <h2><a href="https://rancher.com/project-longhorn-now-available-kubernetes/">Project Longhorn Now Available on Kubernetes</a></h2>
                  
                  <p>
                    <a href="https://rancher.com/author/yasker/" title="Posts by Sheng Yang" class="author url fn" rel="author">Sheng Yang</a>                    March 27, 2018 
                  </p>

                  <p><a href="http://cdn.rancher.com/wp-content/uploads/2018/03/26212907/project-longhorn-logo-blue-1.png"><img class="alignleft wp-image-42068 size-medium" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2018/03/26212907/project-longhorn-logo-blue-1-300x87.png" alt="" width="300" height="87" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2018/03/26212907/project-longhorn-logo-blue-1-300x87.png 300w, https://cdn.rancher.com/wp-content/uploads/2018/03/26212907/project-longhorn-logo-blue-1.png 371w" data-lazy-sizes="(max-width: 300px) 100vw, 300px" /><noscript><img class="alignleft wp-image-42068 size-medium" src="http://cdn.rancher.com/wp-content/uploads/2018/03/26212907/project-longhorn-logo-blue-1-300x87.png" alt="" width="300" height="87" srcset="https://cdn.rancher.com/wp-content/uploads/2018/03/26212907/project-longhorn-logo-blue-1-300x87.png 300w, https://cdn.rancher.com/wp-content/uploads/2018/03/26212907/project-longhorn-logo-blue-1.png 371w" sizes="(max-width: 300px) 100vw, 300px" /></noscript></a>Since we announced Project Longhorn <a href="https://rancher.com/microservices-block-storage/">last year</a>, there has been a great deal of interest in running Longhorn storage on a Kubernetes cluster. Today, I am very excited to announce the availability of Project Longhorn v0.2, which is a persistent storage implementation for any Kubernetes cluster. Once deployed on a Kubernetes cluster, Longhorn automatically clusters all available local storage from all the nodes in the cluster to form replicated and distributed block storage. You can perform snapshot and backup operations on Longhorn volumes, and they will be synchronously replicated onto multiple nodes.<br />
 <a href="https://rancher.com/project-longhorn-now-available-kubernetes/#more-41877" class="more-link"><strong>Read more</strong></a></p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_24 addtoany_list" data-a2a-url="https://rancher.com/project-longhorn-now-available-kubernetes/" data-a2a-title="Project Longhorn Now Available on Kubernetes"><a href="https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes', '');" class="a2a_button_twitter"  title="Twitter" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes', '');" class="a2a_button_hacker_news"  title="Hacker News" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes', '');" class="a2a_button_linkedin"  title="LinkedIn" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes', '');" class="a2a_button_google_plus"  title="Google+" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes', '');" class="a2a_button_reddit"  title="Reddit" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fproject-longhorn-now-available-kubernetes%2F&amp;linkname=Project%20Longhorn%20Now%20Available%20on%20Kubernetes', '');" class="a2a_button_facebook"  title="Facebook" rel="nofollow noopener" target="_blank"></a></div></div>
                  <hr>
              
                  <h2><a href="https://rancher.com/adding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2/">Adding custom nodes to your Kubernetes cluster in Rancher 2.0 Tech Preview 2</a></h2>
                  
                  <p>
                    <a href="https://rancher.com/author/superseb/" title="Posts by Sebastiaan van Steenis" class="author url fn" rel="author">Sebastiaan van Steenis</a>                    February 13, 2018 
                  </p>

                  <p>Recently, we <a href="https://forums.rancher.com/t/rancher-tech-preview-update-2-7-2018/9334" target="_blank" rel="nofollow noopener">announced</a> our second milestone release of Rancher 2.0 Tech Preview 2. This includes the possibility to add custom nodes (nodes that are already provisioned with a Linux operating system and Docker) by running a generated <code>docker run</code> command to launch the <code>rancher/agent</code> container, or by connecting over SSH to that node. In this post, we will explore how we can automate the generation of the command to add nodes using the <code>docker run</code>command.</p>
<p><em>Warning: this is not a production ready product yet, don’t put your production workloads on it just yet.</em></p>
<p><strong>Requirements</strong></p>
<ul>
<li>Host running Linux and Docker</li>
<li>JSON utility <code>jq</code> installed, to parse API responses</li>
<li><code>sha256sum</code> binary to calculate CA certificate checksum</li>
</ul>
<h4>Start Rancher server</h4>
<p>Before we can execute any action, we need to launch the <code>rancher/server</code>container. The image to use for the 2.0 Tech Preview 2 is <code>rancher/server:preview</code> . Another change from 1.6 to 2.0, is that we no longer expose on port 8080. Instead, we expose port 80 and 443, where 80 is by default redirected to 443. You can start the container as follows:</p>
<pre><code>docker run -d -p 80:80 -p 443:443 rancher/server:preview</code></pre>
<p>If you want the data for this setup to be persistent, you can mount a host volume to <code>/var/lib/rancher</code> as shown below:</p>
<pre><code>docker run -d -p 80:80 -p 443:443 -v /data:/var/lib/rancher rancher/server:preview</code></pre>
<h4>Logging in and creating API key</h4>
<p>In Rancher 1.x, there was no authentication enabled by default. After launching the <code>rancher/server</code> container, you could access the API/UI without any credentials. In Rancher 2.0, we enable authentication with the default username and password <code>admin</code>. After logging in, we get a Bearer token, which allows us to change the password. After changing the password, we will create an API key to execute the other requests. The API key is also a Bearer token, which we call <code>automation</code> to be used for automation purposes.</p>
<p><em>Logging in </em></p>
<pre># Login
LOGINRESPONSE=`curl -s 'https://127.0.0.1/v3-public/localProviders/local?action=login' -H 'content-type: application/json' --data-binary '{"username":"admin","password":"admin"}' --insecure`
LOGINTOKEN=`echo $LOGINRESPONSE | jq -r .token`</pre>
<p><em>Changing the password (</em><strong><em>thisisyournewpassword</em></strong><em>)</em></p>
<pre># Change password
curl -s 'https://127.0.0.1/v3/users?action=changepassword' -H 'content-type: application/json' -H "Authorization: Bearer $LOGINTOKEN" --data-binary '{"currentPassword":"admin","newPassword":"thisisyournewpassword"}' --insecure</pre>
<p><em>Create API key</em></p>
<pre># Create API key
APIRESPONSE=`curl -s 'https://127.0.0.1/v3/token' -H 'content-type: application/json' -H "Authorization: Bearer $LOGINTOKEN" --data-binary '{"type":"token","description":"automation"}' --insecure`</pre>
<pre># Extract and store token
APITOKEN=`echo $APIRESPONSE | jq -r .token`</pre>
<h4>Creating the cluster</h4>
<p>With the newly generated API key, we can create a Cluster. When you create a cluster, you have 3 options:</p>
<ul>
<li>Launch a Cloud Cluster (Google Kubernetes Engine/GKE for now)</li>
<li>Create a Cluster (our own Kubernetes installer, <a href="https://medium.com/r/?url=https%3A%2F%2Fgithub.com%2Francher%2Frke%2F" target="_blank" rel="nofollow noopener">Rancher Kubernetes Engine</a>, is used for this)</li>
<li>Import an Existing Cluster (if you already have a Kubernetes cluster, you can import it by inserting the kubeconfig file from that cluster)</li>
</ul>
<p>For this post, we’ll be creating a cluster using Rancher Kubernetes Engine (rke). When you are creating a cluster, you can choose to create new nodes directly when creating the cluster (by creating nodes from cloud providers like DigitalOcean/Amazon) or use pre-existing nodes and let Rancher connect to the node using provided SSH credentials. The method we are discussing in this post (adding node by running the <code>docker run</code> command) is only available after the cluster has been created.</p>
<p>You can create the cluster (<strong>yournewcluster</strong>) using the following commands. As you can see, only the parameter <code>ignoreDockerVersion</code> is included here (which ignores an unsupported Docker version for Kubernetes). The rest will be default, which we will go into in another post. Till then you can discover the configurable options through the UI.</p>
<pre># Create cluster
CLUSTERRESPONSE=`curl -s 'https://127.0.0.1/v3/cluster' -H 'content-type: application/json' -H "Authorization: Bearer $APITOKEN" --data-binary '{"type":"cluster","nodes":[],"rancherKubernetesEngineConfig":{"ignoreDockerVersion":true},"name":"yournewcluster"}' --insecure`</pre>
<pre># Extract clusterid to use for generating the docker run command
CLUSTERID=`echo $CLUSTERRESPONSE | jq -r .id`
</pre>
<p>After running this, you should see your new cluster in the UI. The status will be <code>waiting for nodes to provision or a valid configuration</code> as there are no nodes added yet.</p>
<p><strong>Assembling the </strong><code><strong>docker run</strong></code><strong> command to launch the </strong><code><strong>rancher/agent</strong></code></p>
<p>The final part of adding the node, is to launch the <code>rancher/agent</code> container which will add the node to the cluster. For this to succeed we need:</p>
<ul>
<li>The agent image that is coupled with the Rancher version</li>
<li>The roles for the node (etcd and/or controlplane and/or worker)</li>
<li>The address where the <code>rancher/server</code> container can be reached</li>
<li>Cluster token which the agent uses to join the cluster</li>
<li>Checksum of the CA certificate</li>
</ul>
<p>The agent image can be retrieved from the <code>settings</code> endpoint in the API:</p>
<pre>AGENTIMAGE=`curl -s -H "Authorization: Bearer $APITOKEN" <a href="https://medium.com/r/?url=https%3A%2F%2F127.0.0.1%2Fv3%2Fsettings%2Fagent-image" target="_blank" rel="nofollow noopener">https://127.0.0.1/v3/settings/agent-image</a> --insecure | jq -r .value`</pre>
<p>The roles for the node, you can decide for yourself. (For this example, we’ll be using all three roles):</p>
<pre>ROLEFLAGS="--etcd --controlplane --worker"</pre>
<p>The address where the <code>rancher/server</code> container can be reached, should be self explanatory. The <code>rancher/agent</code> will connect to that endpoint.</p>
<pre>RANCHERSERVER="https://rancher_server_address"</pre>
<p>The cluster token can be retrieved from the created cluster. We saved the created clusterid in <code>CLUSTERID</code> , which we can now use to generate a token.</p>
<pre># Generate token (clusterRegistrationToken)
AGENTTOKEN=`curl -s 'https://127.0.0.1/v3/clusterregistrationtoken' -H 'content-type: application/json' -H "Authorization: Bearer $APITOKEN" --data-binary '{"type":"clusterRegistrationToken","clusterId":"'$CLUSTERID'"}' --insecure | jq -r .token`</pre>
<p>The generated CA certificate is stored in the API as well, and can be retrieved as shown below. We append <code>sha256sum</code> to generate the checksum we need to join the cluster.</p>
<pre># Retrieve CA certificate and generate checksum
CACHECKSUM=`curl -s -H "Authorization: Bearer $APITOKEN" https://127.0.0.1/v3/settings/cacerts --insecure | jq -r .value | sha256sum | awk '{ print $1 }'`</pre>
<p>All data needed to join the cluster is now available, we only need to assemble the command.</p>
<pre># Assemble the docker run command
AGENTCOMMAND="docker run -d --restart=unless-stopped -v /var/run/docker.sock:/var/run/docker.sock --net=host $AGENTIMAGE $ROLEFLAGS --server $RANCHERSERVER --token $AGENTTOKEN --ca-checksum $CACHECKSUM"</pre>
<pre># Show the command
echo $AGENTCOMMAND</pre>
<p>The last command ( <code>echo $AGENTCOMMAND</code> ) should look like this</p>
<pre>docker run -d --restart=unless-stopped -v /var/run/docker.sock:/var/run/docker.sock --net=host rancher/agent:v2.0.2 --etcd --controlplane --worker --server https://rancher_server_address --token xg2hdr8rwljjbv8r94qhrbzpwbbfnkhphq5vjjs4dfxgmb4wrt9rpq --ca-checksum 3d6f14b44763184519a98697d4a5cc169a409e8dde143edeca38aebc1512c31d</pre>
<p>After running this command on a node, you should see it join the cluster and get provisioned by Rancher.</p>
<p><em>Protip: the tokens can also directly be used as basic authentication, for example:</em></p>
<pre>curl -u $APITOKEN <a href="https://medium.com/r/?url=https%3A%2F%2F127.0.0.1%2Fv3%2Fsettings" target="_blank" rel="nofollow noopener">https://127.0.0.1/v3/settings</a> --insecure</pre>
<p>Complete GitHub gist for reference</p>
<p><script src="https://gist.github.com/superseb/29af10c2de2a5e75ef816292ef3ae426.js"></script></p>
<p>Hopefully this post helped with the first steps of automating your Rancher 2.0 Tech Preview 2 setup. We explored what steps you need to take to automatically generate the <code>docker run</code> command to add a node to a Cluster. Keep an eye on this blog for other post regarding Rancher 2.0.</p>
<p>Also, if you have any questions, join our Rancher Users Slack by visiting <a href="https://slack.rancher.io/" target="_blank" rel="nofollow noopener">https://slack.rancher.io</a> and join the #2–0-tech-preview channel. You can also visit our forums to ask any question: <a href="https://forums.rancher.com/" target="_blank" rel="nofollow noopener">https://forums.rancher.com/</a></p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_24 addtoany_list" data-a2a-url="https://rancher.com/adding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2/" data-a2a-title="Adding custom nodes to your Kubernetes cluster in Rancher 2.0 Tech Preview 2"><a href="https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_twitter"  title="Twitter" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_hacker_news"  title="Hacker News" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_linkedin"  title="LinkedIn" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_google_plus"  title="Google+" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_reddit"  title="Reddit" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fadding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2%2F&amp;linkname=Adding%20custom%20nodes%20to%20your%20Kubernetes%20cluster%20in%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_facebook"  title="Facebook" rel="nofollow noopener" target="_blank"></a></div></div>
                  <hr>
              
                  <h2><a href="https://rancher.com/drone-vs-jenkins/">CICD Debates: Drone vs Jenkins</a></h2>
                  
                  <p>
                    <a href="https://rancher.com/author/brandon-adams/" title="Posts by Brandon Adams" class="author url fn" rel="author">Brandon Adams</a>                    January 31, 2018 
                  </p>

                  <p><a href="http://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins.jpg"><img class="alignnone size-full wp-image-38727" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins.jpg" alt="" width="901" height="501" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins.jpg 901w, https://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins-300x167.jpg 300w, https://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins-768x427.jpg 768w" data-lazy-sizes="(max-width: 901px) 100vw, 901px" /><noscript><img class="alignnone size-full wp-image-38727" src="http://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins.jpg" alt="" width="901" height="501" srcset="https://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins.jpg 901w, https://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins-300x167.jpg 300w, https://cdn.rancher.com/wp-content/uploads/2018/01/30160603/cicd-dronejenkins-768x427.jpg 768w" sizes="(max-width: 901px) 100vw, 901px" /></noscript></a></p>
<h2>Introduction</h2>
<p>Jenkins has been the industry standard CI tool for years. It contains a multitude of functionalities, with almost 1,000 plugins in its ecosystem, this can be daunting to some who appreciate simplicity. Jenkins also came up in a world before containers, though it does fit nicely into the environment. This means that there is not a particular focus on the things that make containers great, though with the inclusion of Blue Ocean and pipelines, that is rapidly changing.</p>
<p>Drone is an open source CI tool that wears simple like a badge of honor. It is truly Docker native; meaning that all actions take place within containers. This makes it a perfect fit for a platform like Kubernetes, where launching containers is an easy task.</p>
<p>Both of these tools walk hand in hand with Rancher, which makes standing up a robust Kubernetes cluster an automatic process. I’ve used Rancher 1.6 to deploy a K8s 1.8 cluster on GCE; as simple as can be.</p>
<p>This article will take Drone deployed on Kubernetes (on Rancher), and compare it to Jenkins across three categories:</p>
<ol>
<li>Platform installation and management</li>
<li>Plugin ecosystem</li>
<li>Pipeline details</li>
</ol>
<p>In the end, I’ll stack them up side by side and try to give a recommendation. As usually is the case however, there may not be a clear winner. Each tool has its core focus, though by nature there will be overlap.</p>
<h2>Prereqs</h2>
<p>Before getting started, we need to do a bit of set up. This involves setting up Drone as an authorized Oauth2 app with a Github account. You can see the settings I’ve used here. All of this is contained within the Drone documentation.</p>
<p>There is one gotcha which I encountered setting up Drone. Drone maintains a passive relationship with the source control repository. In this case, this means that it sets up a webhook with Github for notification of events. The default behavior is to build on push and PR merge events. In order for Github to properly notify Drone, the server must be accessible to the world. With other, on-prem SCMs, this would not be the case, but for the example described here it is. I’ve set up my Rancher server on GCE, so that it is reachable from Github.com.</p>
<p>Drone installs from a container through a set of deployment files, just like any other Kubernetes app. I&#8217;ve adapted the deployment files found in this repo. Within the config map spec file, there are several values we need to change. Namely, we need to set the Github-related values to ones specific to our account. We’ll take the client secret and client key from the setup steps and place them into this file, as well as the username of the authorized user. Within the drone-secret file, we can place our Github password in the appropriate slot.</p>
<p>This is a major departure from the way Jenkins interacts with source code. In Jenkins, each job can define its relationship with source control independent of another job. This allows you to pull source from a variety of different repositories, including Github, Gitlab, svn, and others. As of now, Drone only supports git-based repos. A full list is available in the documentation, but all of the most popular choices for git-based development are supported.</p>
<p>We also can&#8217;t forget our Kubernetes cluster! Rancher makes it incredibly easy to launch and manage a cluster. I&#8217;ve chosen to use latest stable version of Rancher, 1.6. We could&#8217;ve used the new Rancher 2.0 tech preview, but constructing this guide worked best with the stable version. however, the information and steps to install should be the same, so if you&#8217;d like to try it out with newer Rancher, go ahead!</p>
<h2>Task 1 &#8211; Installation and Management</h2>
<p>Launching Drone on Kubernetes and Rancher is as simple as copy paste. I used the default K8s dashboard to launch the files. Uploading them one by one, starting with the namespace and config files, will get the ball rolling. [Here are some of the deployment files I used](https://github.com/appleboy/drone-on-kubernetes/tree/master/gke). I pulled from this repository and made my own local edits. This repo is owned by a frequent Drone contributor, and includes instructions on how to launch on GCE, as well as AWS. The Kubernetes yaml files are the only things we need here. To replicate, just edit the ConfigMap file with your specific values. Check out one of my files below.</p>
<div class="sourceCode">
<pre class="sourceCode yaml"><code class="sourceCode yaml">
<span class="co">yaml</span>
<span class="co">apiVersion: extensions/v1beta1</span>
<span class="fu">kind:</span> Deployment
<span class="fu">metadata:</span>
  <span class="fu">name:</span> drone-server
<span class="fu">namespace:</span> drone
<span class="fu">spec:</span> 
<span class="fu">replicas: </span> 1
<span class="fu">template:</span> 
<span class="fu">metadata:</span> 
<span class="fu">labels:</span> 
<span class="fu">app:</span> drone-server
<span class="fu">spec:</span> 
<span class="fu">containers:</span> 
<span class="fu">- image:</span> drone/drone:0.8
<span class="fu">imagePullPolicy: </span> Always
<span class="fu">name: </span> drone-server
<span class="fu">ports:</span>
<span class="fu">- containerPort: </span>8000
<span class="fu">protocol: </span> TCP
<span class="fu">- containerPort: </span>9000
<span class="fu">protocol: </span>TCP
<span class="fu">volumeMounts:</span>
<span class="fu"># Persist our configs in an SQLite DB in here</span>
<span class="fu">- name: </span>drone-server-sqlite-db
<span class="fu">mountPath: </span>/var/lib/drone
<span class="fu">resources:</span> 
<span class="fu">requests:</span>
<span class="fu">cpu: </span>40m
<span class="fu">memory: </span>32Mi
<span class="fu">env:</span>
<span class="fu">- name: </span>DRONE_HOST
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">name: drone-config</span>
<span class="fu">key: server.host</span>
<span class="fu">- name: </span>DRONE_OPEN
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">name: </span>drone-config
<span class="fu">key: </span>server.open
<span class="fu">- name:</span>DRONE_DATABASE_DRIVER
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">name: </span>drone-config
<span class="fu">key: </span>server.database.driver
<span class="fu">- name: </span>DRONE_DATABASE_DATASOURCE
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">name: drone-config</span>
<span class="fu">key: </span>server.database.datasource
<span class="fu">- name: </span>DRONE_SECRET
<span class="fu">valueFrom:</span>
<span class="fu">secretKeyRef:</span>
<span class="fu">name: </span>drone-secrets
<span class="fu">key: </span>server.secret
<span class="fu">- name: </span>DRONE_ADMIN
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">name: drone-config</span>
<span class="fu">key: </span>server.admin
<span class="fu">- name: </span>DRONE_GITHUB
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">name: </span>drone-config
<span class="fu">key: </span>server.remote.github
<span class="fu">- name: DRONE_GITHUB_CLIENT</span>
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">name: drone-config</span>
<span class="fu">key: server.remote.github.client</span>
<span class="fu">- name: DRONE_GITHUB_SECRET</span>
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">key: server.remote.github.secret</span>
<span class="fu">- name: DRONE_DEBUG</span>
<span class="fu">valueFrom:</span>
<span class="fu">configMapKeyRef:</span>
<span class="fu">name: drone-config</span>
<span class="fu">key: server.debug</span>

<span class="fu">volumes:</span>
<span class="fu">- name: drone-server-sqlite-db</span>
<span class="fu">hostPath:</span>
<span class="fu">path: /var/lib/k8s/drone</span>
<span class="fu">- name: docker-socket</span>
<span class="fu">hostPath:</span>
<span class="fu">path: /var/run/docker.sock</span>
</code></pre>
</div>
<p>Jenkins can be launched in much the same way. Because it is deployable in a Docker container, you can construct a similar deployment file and launch on Kubernetes. Here&#8217;s an example below. This file was taken from the GCE examples repo for the Jenkins CI server.</p>
<div class="sourceCode">
<pre class="sourceCode yaml"><code class="sourceCode yaml">
<span class="co">yaml</span>
<span class="fu">apiVersion: extensions/v1beta1</span>
<span class="fu">kind: Deployment</span>
<span class="fu">metadata:</span>
<span class="fu">name: jenkins</span>
<span class="fu">namespace: jenkins</span>
<span class="fu">spec:</span>
<span class="fu">replicas: 1</span>
<span class="fu">template:</span>
<span class="fu">metadata:</span>
<span class="fu">labels:</span>
<span class="fu">app: master</span>
<span class="fu">spec:</span>
<span class="fu">containers:</span>
<span class="fu">- name: master</span>
<span class="fu">image: jenkins/jenkins:2.67</span>
<span class="fu">ports:</span>
<span class="fu">- containerPort: 8080</span>
<span class="fu">- containerPort: 50000</span>
<span class="fu">readinessProbe:</span>
<span class="fu">httpGet:</span>
<span class="fu">path: /login</span>
<span class="fu">port: 8080</span>
<span class="fu">periodSeconds: 10</span>
<span class="fu">timeoutSeconds: 5</span>
<span class="fu">successThreshold: 2</span>
<span class="fu">failureThreshold: 5</span>
<span class="fu">env:</span>
<span class="fu">- name: JENKINS_OPTS</span>
<span class="fu">valueFrom:</span>
<span class="fu">secretKeyRef:</span>
<span class="fu">name: jenkins</span>
<span class="fu">key: options</span>
<span class="fu">- name: JAVA_OPTS</span>
<span class="fu">value: '-Xmx1400m'</span>
<span class="fu">volumeMounts:</span>
<span class="fu">- mountPath: /var/jenkins_home</span>
<span class="fu">name: jenkins-home</span>
<span class="fu">resources:</span>
<span class="fu">limits:</span>
<span class="fu">cpu: 500m</span>
<span class="fu">memory: 1500Mi</span>
<span class="fu">requests:</span>
<span class="fu">cpu: 500m</span>
<span class="fu">memory: 1500Mi</span>
<span class="fu">volumes:</span>
<span class="fu">- name: jenkins-home</span>
<span class="fu">gcePersistentDisk:</span>
<span class="fu">pdName: jenkins-home</span>
<span class="fu">fsType: ext4</span>
<span class="fu">partition: 1</span>
</code></pre>
</div>
<p>Launching Jenkins is similarly easy. Because of the simplicity of Docker and Rancher, all you need to do is take the set of deployment files and paste them into the dashboard. My preferred way is using the Kubernetes dashboard for all management purposes. From here, I can upload the Jenkins files one by one to get the server up and running.</p>
<p>Managing the Drone server comes down to configurations passed when launching. Hooking up to Github involved adding OAuth2 tokens, as well as (in my case) a username and password to access a repository. changing this would involve either granting organization access through GIthub, or relaunching the server with new credentials. This could possibly hamper development, as it means that Drone cannot handle more than one source provider. As mentioned above, Jenkins allows for any number of source repos, with the caveat that each job only uses one.</p>
<h2>Task 2 &#8211; Plugins</h2>
<p>Plugins in Drone are very simple to configure and manage. In fact, there isn&#8217;t much you need to do to get one up and running. The ecosystem is considerably smaller than that for Jenkins, but there are still plugins for almost every major tool available. There are plugins for most major cloud providers, as well as integrations with popular source control repos. As mentioned before, containers in Drone are first class citizens. This means that each plugin and executed task is also a container.<br />
Jenkins is the undisputed king of plugins. If you can think of the task, there is probably a plugin to accomplish it. There are at last glance, almost 1000 plugins available for use. The downside of this is that it can sometimes be difficult to determine, out of a selection of similar looking plugins, which one is the best choice for what you&#8217;re trying to accomplish</p>
<p>There are docker plugins for building pushing and images, AWS and K8s plugins for deploying to clusters, and various others. Because of the comparative youth of the Drone platform, there are a great deal fewer plugins available here than for Jenkins. That does not however, take away from their effectiveness and ease of use. A simple stanza in a drone.yml file will automatically download, configure, and run a selected plugin, with no other input needed. And remember, because of Drone&#8217;s relationship with containers, each plugin is maintained within an image. There are no extra dependencies to manage; if the plugin creator has done their job correctly, everything will be contained within that container.</p>
<p>When I built the drone.yml file for the simple node app, adding a Docker plugin was a breeze. There were only a few lines needed, and the image was built and pushed to a Dockerhub repo of my choosing. In the next section, you can see the section labeled docker. This stanza is all that&#8217;s needed to configure and run the plugin to build and push the Docker image.</p>
<h2>Task 3</h2>
<p>The last task is the bread and butter of any CI system. Drone and Jenkins are both designed to build apps. Originally, Jenkins was targeted towards java apps, but over the years the scope has expanded to include anything you could compile and execute as code. Jenkins even excels at new pipelines and cron-job like scheduled tasks. However, it is not container native, though it does fit very well into the container ecosystem.</p>
<div class="sourceCode">
<pre class="sourceCode yaml"><code class="sourceCode yaml">
<span class="co">yaml</span>
<span class="fu">pipeline:</span>
<span class="fu">  build:</span>
<span class="fu">    image: node:alpine</span>
<span class="fu">    commands:</span>
<span class="fu">      - npm install</span>
<span class="fu">      - npm run test</span>
<span class="fu">      - npm run build</span>
<span class="fu">  docker:</span>
<span class="fu">    image: plugins/docker</span>
<span class="fu">    dockerfile: Dockerfile</span>
<span class="fu">    repo: badamsbb/node-example</span>
<span class="fu">    tags: v1</span>
</code></pre>
</div>
<p>For comparison, here&#8217;s a Jenkinsfile for the same app.</p>
<div class="sourceCode">
<pre class="sourceCode groovy"><code class="sourceCode groovy">
<span class="co">groovy</span>
<span class="fu">#!/usr/bin/env groovy</span>
<span class="fu">pipeline {</span>
<span class="fu"> agent {</span>
<span class="fu">  node {</span>
<span class="fu">   label 'docker'</span>
<span class="fu">  }</span>
<span class="fu"> }</span>
<span class="fu"> tools {</span>
<span class="fu">  nodejs 'node8.4.0'</span>
<span class="fu"> }</span>
<span class="fu"> stages {</span>
<span class="fu">  stage ('Checkout Code') {</span>
<span class="fu">   steps {</span>
<span class="fu">    checkout scm</span>
<span class="fu">   }</span>
<span class="fu">  }</span>
<span class="fu">  stage ('Verify Tools'){</span>
<span class="fu">   steps {</span>
<span class="fu">    parallel (</span>
<span class="fu">     node: {</span>
<span class="fu">       sh "npm -v"</span>
<span class="fu">     },</span>
<span class="fu">     docker: {</span>
<span class="fu">       sh "docker -v"</span>
<span class="fu">     }</span>
<span class="fu">    )</span>
<span class="fu">   }</span>
<span class="fu">  }</span>
<span class="fu">  stage ('Build app') {</span>
<span class="fu">   steps {</span>
<span class="fu">    sh "npm prune"</span>
<span class="fu">    sh "npm install"</span>
<span class="fu">   }</span>
<span class="fu">  }</span>
<span class="fu">  stage ('Test'){</span>
<span class="fu">   steps {</span>
<span class="fu">    sh "npm test"</span>
<span class="fu">   }</span>
<span class="fu">  }</span>
<span class="fu">  stage ('Build container') {</span>
<span class="fu">   steps {</span>
<span class="fu">    sh "docker build -t badamsbb/node-example:latest ."</span>
<span class="fu">    sh "docker tag badamsbb/node-example:latest badamsbb/node-example:v${env.BUILD_ID}"</span>
<span class="fu">   }</span>
<span class="fu">  }</span>
<span class="fu">  stage ('Verify') {</span>
<span class="fu">   steps {</span>
<span class="fu">    input "Everything good?"</span>
<span class="fu">   }</span>
<span class="fu">  }</span>
<span class="fu">  stage ('Clean') {</span>
<span class="fu">   steps {</span>
<span class="fu">    sh "npm prune"</span>
<span class="fu">    sh "rm -rf node_modules"</span>
<span class="fu">   }</span>
<span class="fu">  }</span>
<span class="fu"> }</span>
<span class="fu">}</span>
</code></pre>
</div>
<p>While this example is verbose for the sake of explanation, you can see that accomplishing the same goal, a built Docker image, can be more involved than with Drone. In addition, what&#8217;s not pictured is the set up of the interactions between Jenkins and Docker. Because Jenkins is not Docker native, agent must be configured ahead of time to properly interact with the Docker daemon. This can be confusing to some, which is where Drone comes out ahead. It is already running on top of Docker; this same Docker is used to run its tasks.</p>
<h2>Conclusion</h2>
<p>Drone is a wonderful piece of CI software. It has quickly become a very popular choice for wanting to get up and running quickly, looking for a simple container-native CI solution. The simplicity of it is elegant, though as it is still in a pre-release status, there is much more to come. Adventurous engineers may be willing to give it a shot in production, and indeed many have. In my opinion, it is best suited to smaller teams looking to get up and running quickly. Its small footprint and simplicity of use lends itself readily to this kind of development.</p>
<p>However, Jenkins is the tried and true powerhouse of the CI community. It takes a lot to topple the king, especially one so entrenched in his position. Jenkins has been very successful at adapting to the market, with Blue Ocean and container-based pipelines making strong cases for its staying power. Jenkins can be used by teams of all sizes, but excels at scale. Larger organizations love Jenkins due to its history and numerous integrations. It also has distinct support options, either active community support for open source, or enterprise-level support through CloudBees But as with all tools, both Drone and Jenkins have their place within the CI ecosystem.</p>
<h3>Bio</h3>
<p>Brandon Adams<br />
Certified Jenkins Engineer, and Docker enthusiast. I&#8217;ve been using Docker since the early days, and love hearing about new applications for the technology. Currently working for a Docker consulting partner in Bethesda, MD.</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_24 addtoany_list" data-a2a-url="https://rancher.com/drone-vs-jenkins/" data-a2a-title="CICD Debates: Drone vs Jenkins"><a href="https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins', '');" class="a2a_button_twitter"  title="Twitter" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins', '');" class="a2a_button_hacker_news"  title="Hacker News" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins', '');" class="a2a_button_linkedin"  title="LinkedIn" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins', '');" class="a2a_button_google_plus"  title="Google+" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins', '');" class="a2a_button_reddit"  title="Reddit" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fdrone-vs-jenkins%2F&amp;linkname=CICD%20Debates%3A%20Drone%20vs%20Jenkins', '');" class="a2a_button_facebook"  title="Facebook" rel="nofollow noopener" target="_blank"></a></div></div>
                  <hr>
              
                  <h2><a href="https://rancher.com/announcing-rancher-2-0-tech-preview-2/">Announcing Rancher 2.0 Tech Preview 2</a></h2>
                  
                  <p>
                    <a href="https://rancher.com/author/shengl/" title="Posts by Sheng Liang" class="author url fn" rel="author">Sheng Liang</a>                    January 24, 2018 
                  </p>

                  <p>Today we released the second tech preview of Rancher 2.0, our next major Rancher product release. We’ve been hard at work since the last tech preview release in September 2017, driven by the overwhelmingly positive response to our Rancher 2.0 vision and a great deal of feedback we have received.</p>
<p>The Tech Preview 2 release contains many significant changes and enhancements:</p>
<p>1. Rancher server is now 100% written in Go and no longer requires a MySQL database.<br />
2. You can deploy Rancher server on any Docker host as before, or you can deploy Rancher server on an existing Kubernetes cluster.<br />
3. You can create new Kubernetes clusters using Rancher Kubernetes Engine (RKE) or cloud-managed Kubernetes services such as GKE. Rancher automates both RKE and GKE cluster provisioning. Support for additional cloud-managed Kubernetes services such as EKS and AKS will be added in the future.<br />
4. You can manage all your Kubernetes clusters from a unified cluster management interface. Rancher implements centralized authentication and authorization across all Kubernetes clusters, regardless where these Kubernetes clusters are hosted.<br />
5. Rancher provides a simple workload management interface across all your Kubernetes clusters. This is still a work in progress. We continue to offer an intuitive Rancher 1.0-style container-centric interface. We are working on adding many advanced workload management features such as the app catalog, CI/CD and monitoring integration, sophisticated stats, and centralized logging.</p>
<p>If you are interested in more technical details, take a look at the <a href="https://cdn2.hubspot.net/hubfs/468859/Whitepapers/Rancher-2.0-Architecture-v0.6-jan-2018.pdf">updated Rancher 2.0 Architecture Document</a>, <a href="https://rancher.com/docs/rancher/v2.0/en/quick-start-guide/">The Quick Start Guide</a>, and the <a href="https://github.com/rancher/rancher/releases">Technical Release 2 page</a> on Github.</p>
<p>Also, enjoy the <a href="https://www.youtube.com/watch?v=ld7ctOg3waM&amp;t=5753s">recording</a> of the online meetup where we gave a live demo.</p>
<p>Again, Rancher 2.0 is a work-in-progress. We’ll be rolling out new features in the coming days and weeks as we get ready for our Beta release next month. You can <a href="http://info.rancher.com/rancher2-beta-user-community-registration">register here</a> to be part of the Beta User Community.</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_24 addtoany_list" data-a2a-url="https://rancher.com/announcing-rancher-2-0-tech-preview-2/" data-a2a-title="Announcing Rancher 2.0 Tech Preview 2"><a href="https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_twitter"  title="Twitter" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_hacker_news"  title="Hacker News" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_linkedin"  title="LinkedIn" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_google_plus"  title="Google+" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_reddit"  title="Reddit" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fannouncing-rancher-2-0-tech-preview-2%2F&amp;linkname=Announcing%20Rancher%202.0%20Tech%20Preview%202', '');" class="a2a_button_facebook"  title="Facebook" rel="nofollow noopener" target="_blank"></a></div></div>
                  <hr>
              
                  <h2><a href="https://rancher.com/using-kubernetes-api-go-kubecon-2017-session-recap/">Using Kubernetes API from Go: Kubecon 2017 session recap</a></h2>
                  
                  <p>
                    <a href="https://rancher.com/author/alena/" title="Posts by Alena Prokharchyk" class="author url fn" rel="author">Alena Prokharchyk</a>                    January 19, 2018 
                  </p>

                  <p>Last month I had the great pleasure of attending Kubecon 2017, which took place in Austin, TX. The conference was super informative, and deciding on what session to join was really hard as all of them were great. But what deserves special recognition is how well the organizers respected the attendees&#8217; diversity of Kubernetes experiences. Support is especially important if you are new to the project and need advice (and sometimes encouragement) to get started. Kubernetes 101 track sessions were a good way to get more familiar with the concepts, tools and the community. I was very excited to be a speaker on 101 track, and this blog post is a recap of my session <a href="https://www.youtube.com/watch?v=QIMz4V9WxVc">Using Kubernetes APIs from Go</a></p>
<p>In this article we are going to learn what makes Kubernetes a great platform for developers, and cover the basics of writing a custom controller for Kubernetes in the Go language using the client-go library.</p>
<h2>Kubernetes is a platform</h2>
<p>Kubernetes can be liked for many reasons. As a user, you appreciate its features richness, stability and performance. As a contributor, the Kubernetes open source community is not only large, but approachable and responsive. But what really makes Kubernetes appealing to a third party developer is its extensibility. The project provides so many ways to add new features, extend existing ones without disrupting the main code base. And thats what makes Kubernetes a platform.</p>
<p>Here are some ways to extend Kubernetes:</p>
<p>&nbsp;</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/15160900/Screen-Shot-2017-12-01-at-3.50.21-PM.png"><img class="alignnone size-full wp-image-36204" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/15160900/Screen-Shot-2017-12-01-at-3.50.21-PM.png" alt="" width="741" height="418" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15160900/Screen-Shot-2017-12-01-at-3.50.21-PM.png 741w, https://cdn.rancher.com/wp-content/uploads/2017/12/15160900/Screen-Shot-2017-12-01-at-3.50.21-PM-300x169.png 300w" data-lazy-sizes="(max-width: 741px) 100vw, 741px" /><noscript><img class="alignnone size-full wp-image-36204" src="http://cdn.rancher.com/wp-content/uploads/2017/12/15160900/Screen-Shot-2017-12-01-at-3.50.21-PM.png" alt="" width="741" height="418" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15160900/Screen-Shot-2017-12-01-at-3.50.21-PM.png 741w, https://cdn.rancher.com/wp-content/uploads/2017/12/15160900/Screen-Shot-2017-12-01-at-3.50.21-PM-300x169.png 300w" sizes="(max-width: 741px) 100vw, 741px" /></noscript></a></p>
<p>On the picture, you can see that every Kuberentes cluster component can be extended in a certain way, whether it is a Kubelet, or API server. Today we are going to focus on a &#8220;Custom Controller&#8221; way, I&#8217;ll refer to it as Kubernetes Controller or simply a Controller from now on.</p>
<h2>What exactly is Kubernetes Controller?</h2>
<p>The most common definition for controller is &#8220;Code that brings current state of the system to the desired state&#8221;. But what exactly does it mean? Lets look at Ingress controller example. Ingress is a Kubernetes resource that lets you define external access to the services in cluster, typically in HTTP and usually with the Load Balancing support. But Kubernetes core code has no ingress implementation. The implementation gets covered by the third party controllers that would:</p>
<ul>
<li>Watch ingress/services/endpoints resource events (Create/Update/Remove)</li>
<li>Program internal or external Load Balancer</li>
<li>Update Ingress with the Load Balancer address</li>
</ul>
<p>The &#8220;desired&#8221; state of the ingress is the IP Address pointing to the functioning Load Balancer programmed with the rules defined by the user in Ingress specification. And external ingress controller is responsible for bringing the ingress resource to this state.</p>
<p>The implementation of the controller for the same resource, as well as the way to deploy them, can vary. You can pick nginx controller and deploy it on every node in your cluster as a Daemon Set, or you can chose to run your ingress controller outside of Kubernetes cluster and program F5 as a Load Balancer. There are no strict rules, Kubernetes is flexible in that way.</p>
<h2>Client-go</h2>
<p>There are several ways to get information about Kubernetes cluster and its resources. You can do it using Dashboard, kubectl, or using programmatic access to Kubernetes APIs. <a href="https://github.com/kubernetes/client-go">Client-go</a> is the most popular library used by the tools written in Go. There are clients for many other languages out there (java, python, etc). Although if you want to write your very first controller, I encourage you to try go/client-go. Kubernetes is written in Go, and I find it easier to develop a plugin in the same language the main project is written.</p>
<h2>Lets build&#8230;</h2>
<p>The best way to get familiar with the platforms and tools around it, is to write something. Lets start simple, and implement a controller that:</p>
<ul>
<li>Monitors Kubernetes nodes</li>
<li>Alerts when storage occupied by images on the node, changes</li>
</ul>
<p>The code source can be found <a href="https://github.com/alena1108/kubecon2017">here</a>.</p>
<h2>Ground work</h2>
<h3>Setup the project</h3>
<p>As a developer, I like to sneak a peek at the tools my peers use to make their life easier. Here I&#8217;m going to share 3 favorite tools of mine that are gonna help us with our very first project.</p>
<ol>
<li> <a href="https://github.com/rancher/go-skel">go-skel</a> &#8211; skeleton for Go microservices Just run ./skel.sh test123, and it will create the skeleton for the new go project test123.</li>
<li> <a href="https://github.com/rancher/trash">trash</a> &#8211; Go vendor management tool. There are many go dependencies management tools out there, but trash has been proved to be simple to use and great when it comes to transient dependencies management.</li>
<li><a href="https://github.com/rancher/dapper">dapper</a> &#8211; a tool to wrap any existing build tool in an consistent environment</li>
</ol>
<h3>Add client-go as a dependency</h3>
<p>In order to use client-go code, we have to pull it as a dependency to our project. Add it to vendor.conf:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM.png"><img class="alignnone wp-image-36209" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM.png" alt="" width="529" height="146" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM.png 1250w, https://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM-300x83.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM-768x213.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM-1024x283.png 1024w" data-lazy-sizes="(max-width: 529px) 100vw, 529px" /><noscript><img class="alignnone wp-image-36209" src="http://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM.png" alt="" width="529" height="146" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM.png 1250w, https://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM-300x83.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM-768x213.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/15164328/Screen-Shot-2017-12-15-at-3.39.38-PM-1024x283.png 1024w" sizes="(max-width: 529px) 100vw, 529px" /></noscript></a></p>
<p>And run <code>trash</code>. It will automatically pull all the dependencies defined in vendor.conf to the vendor folder of the project. Make sure client-go version is compatible with the Kubernetes version of your cluster.</p>
<h3>Create a client</h3>
<p>Before creating a client that is going to talk to Kubernetes API, we have to decide how we want to run our tool: inside or outside the Kubernetes cluster. When run inside the cluster, your application is containerized and gets deployed as Kubernetes Pod. It gives you certain perks &#8211; you can chose the way to deploy it (Daemon set to run on every node, or as a Deployment with n replicas), configure the healthcheck for it, etc. When your application runs outside of the cluster, you have to manage it yourself. Lets make our tool flexible, and support both ways of defining the client based on the config flag:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM.png"><img class="alignnone wp-image-36216" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM.png" alt="" width="511" height="301" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM.png 1274w, https://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM-300x177.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM-768x453.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM-1024x604.png 1024w" data-lazy-sizes="(max-width: 511px) 100vw, 511px" /><noscript><img class="alignnone wp-image-36216" src="http://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM.png" alt="" width="511" height="301" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM.png 1274w, https://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM-300x177.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM-768x453.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/15172050/Screen-Shot-2017-12-15-at-4.20.31-PM-1024x604.png 1024w" sizes="(max-width: 511px) 100vw, 511px" /></noscript></a></p>
<p>We are going to use outside of cluster mode while debugging the app as this way you do not have to build the image every time and redeploy as kubernetes Pod. Once app is tested, we can build and image and deploy it in cluster.</p>
<p>As you can see on the screen shot, the config is being built, and passed to <code>kubernetes.NewForConfig</code> to generate the client.</p>
<h2>Play with basic CRUDs</h2>
<p>For our tool, we need to monitor Nodes. It is a good idea to get familiar with the way to do CRUD operations using client-go before implementing the logic:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM.png"><img class="alignnone size-full wp-image-36219" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM.png" alt="" width="1836" height="824" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM.png 1836w, https://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM-300x135.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM-768x345.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM-1024x460.png 1024w" data-lazy-sizes="(max-width: 1836px) 100vw, 1836px" /><noscript><img class="alignnone size-full wp-image-36219" src="http://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM.png" alt="" width="1836" height="824" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM.png 1836w, https://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM-300x135.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM-768x345.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/15173503/Screen-Shot-2017-12-15-at-4.34.39-PM-1024x460.png 1024w" sizes="(max-width: 1836px) 100vw, 1836px" /></noscript></a></p>
<p>Screen shot above displays how to do:</p>
<ul>
<li>List nodes named &#8220;minikube&#8221; which can be achieved by passing FieldSelector filter to the command.</li>
<li>Update the node with the new annotation</li>
<li>Delete the node with the gracePeriod=10 seconds &#8211; meaning that the removal will happen only after 10 seconds since the command is issued.</li>
</ul>
<p>All that is done using the clientset we&#8217;ve created on the previous step.</p>
<p>We would need information about the images on the node; it can be retrieved by accessing corresponding field:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM.png"><img class="alignnone wp-image-36220 " src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM.png" alt="" width="331" height="82" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM.png 774w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM-300x74.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM-768x191.png 768w" data-lazy-sizes="(max-width: 331px) 100vw, 331px" /><noscript><img class="alignnone wp-image-36220 " src="http://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM.png" alt="" width="331" height="82" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM.png 774w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM-300x74.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174151/Screen-Shot-2017-12-15-at-4.41.36-PM-768x191.png 768w" sizes="(max-width: 331px) 100vw, 331px" /></noscript></a></p>
<h2>Watch/Notify using Informer</h2>
<p>Now we know how to fetch the nodes from Kubernetes APIs and get images information from it. How do we monitor the changes to images&#8217; size? The most simple way would be to periodically poll the nodes, calculate the current images storage capacity and compare it with the result from the previous poll. The downside to that &#8211; we execute the list call to fetch all the nodes, no matter if there were changes to them or not, and that can be expensive especially if your poll interval is small. What we really want is &#8211; to be notified when the node gets changed, and only then do our logic. Thats where client-go Informer comes to the rescue.</p>
<h2><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM.png"><img class="alignnone size-full wp-image-36223" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM.png" alt="" width="1826" height="708" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM.png 1826w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM-300x116.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM-768x298.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM-1024x397.png 1024w" data-lazy-sizes="(max-width: 1826px) 100vw, 1826px" /><noscript><img class="alignnone size-full wp-image-36223" src="http://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM.png" alt="" width="1826" height="708" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM.png 1826w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM-300x116.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM-768x298.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/15174945/Screen-Shot-2017-12-15-at-4.49.19-PM-1024x397.png 1024w" sizes="(max-width: 1826px) 100vw, 1826px" /></noscript></a></h2>
<p>On this example, we create the Informer for the Node object by passing the <code>watchList</code> instruction on how to monitor the Node, object type <code>api.Node</code> and 30 seconds as a resync period instructing to periodically poll the node even when there were no changes to it &#8211; a nice way to fall back on in case the update event gets dropped by some reason. And as a last argument, we are passing 2 call back functions &#8211; handleNodeAdd and handleNodeUpdate. Those callbacks will have an actual logic that has to be triggered on the node&#8217;s changes &#8211; find out whether the storage occupied by images on the node got changed. The NewInformer gives back 2 objects &#8211; controller and store. Once the controller is started, the watch on node.update and node.add will start, and the callback functions will get called. The store is in memory cache which gets updated by the informer, and you can fetch the node object from the cache instead of calling Kubernetes APIs directly:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM.png"><img class="alignnone wp-image-36334" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM.png" alt="" width="509" height="111" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM.png 1214w, https://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM-300x65.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM-768x167.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM-1024x223.png 1024w" data-lazy-sizes="(max-width: 509px) 100vw, 509px" /><noscript><img class="alignnone wp-image-36334" src="http://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM.png" alt="" width="509" height="111" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM.png 1214w, https://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM-300x65.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM-768x167.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/17140240/Screen-Shot-2017-12-17-at-1.01.53-PM-1024x223.png 1024w" sizes="(max-width: 509px) 100vw, 509px" /></noscript></a></p>
<p>As we have a single controller in our project, using regular Informer is fine enough. But if your future project ends up having several controllers for the same object, using SharedInformer is more recommended. So instead of creating multiple regular informers &#8211; one per controller &#8211; you can register one Shared informer, and let each controller register its own set of callbacks, and get back a shared cache in return which will reduce memory footprint:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM.png"><img class="alignnone wp-image-36336" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM.png" alt="" width="538" height="357" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM.png 1242w, https://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM-300x199.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM-768x508.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM-1024x678.png 1024w" data-lazy-sizes="(max-width: 538px) 100vw, 538px" /><noscript><img class="alignnone wp-image-36336" src="http://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM.png" alt="" width="538" height="357" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM.png 1242w, https://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM-300x199.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM-768x508.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/17141220/Screen-Shot-2017-12-17-at-1.12.01-PM-1024x678.png 1024w" sizes="(max-width: 538px) 100vw, 538px" /></noscript></a></p>
<h2>Deployment time</h2>
<p>Now it is time to deploy and test the code! For the first run, we are simply building a go binary and run it in out of cluster mode:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM.png"><img class="alignnone size-full wp-image-36342" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM.png" alt="" width="1756" height="308" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM.png 1756w, https://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM-300x53.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM-768x135.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM-1024x180.png 1024w" data-lazy-sizes="(max-width: 1756px) 100vw, 1756px" /><noscript><img class="alignnone size-full wp-image-36342" src="http://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM.png" alt="" width="1756" height="308" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM.png 1756w, https://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM-300x53.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM-768x135.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/17143605/Screen-Shot-2017-12-17-at-1.35.47-PM-1024x180.png 1024w" sizes="(max-width: 1756px) 100vw, 1756px" /></noscript></a></p>
<p>To change the message output, deploy a pod using an image which is not presented on the node yet.</p>
<p>Once basic functionality is tested, it is time to try running it in cluster mode. For that, we have to create the image first. Define the Dockerfile:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/17143354/Screen-Shot-2017-12-17-at-1.33.24-PM.png"><img class="alignnone wp-image-36340" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/17143354/Screen-Shot-2017-12-17-at-1.33.24-PM.png" alt="" width="190" height="73" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17143354/Screen-Shot-2017-12-17-at-1.33.24-PM.png 400w, https://cdn.rancher.com/wp-content/uploads/2017/12/17143354/Screen-Shot-2017-12-17-at-1.33.24-PM-300x116.png 300w" data-lazy-sizes="(max-width: 190px) 100vw, 190px" /><noscript><img class="alignnone wp-image-36340" src="http://cdn.rancher.com/wp-content/uploads/2017/12/17143354/Screen-Shot-2017-12-17-at-1.33.24-PM.png" alt="" width="190" height="73" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17143354/Screen-Shot-2017-12-17-at-1.33.24-PM.png 400w, https://cdn.rancher.com/wp-content/uploads/2017/12/17143354/Screen-Shot-2017-12-17-at-1.33.24-PM-300x116.png 300w" sizes="(max-width: 190px) 100vw, 190px" /></noscript></a></p>
<p>And create an image using <code>docker build .</code> It will generate the image that you can use to deploy the pod in Kubernetes. Now your application can be run as a Pod in Kubernetes cluster. <a href="https://github.com/alena1108/kubecon2017/blob/master/kubecon_demo_deployment.yaml">Here</a> is an example of deployment definition, and on the screen shot above I&#8217;m using it to deploy our app:</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM.png"><img class="alignnone size-full wp-image-36344" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM.png" alt="" width="2178" height="468" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM.png 2178w, https://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM-300x64.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM-768x165.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM-1024x220.png 1024w" data-lazy-sizes="(max-width: 2178px) 100vw, 2178px" /><noscript><img class="alignnone size-full wp-image-36344" src="http://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM.png" alt="" width="2178" height="468" srcset="https://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM.png 2178w, https://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM-300x64.png 300w, https://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM-768x165.png 768w, https://cdn.rancher.com/wp-content/uploads/2017/12/17144848/Screen-Shot-2017-12-17-at-1.48.12-PM-1024x220.png 1024w" sizes="(max-width: 2178px) 100vw, 2178px" /></noscript></a></p>
<p>So we have:</p>
<ul>
<li>Created go project</li>
<li>Added client-go package dependencies to it</li>
<li>Created a client to talk to Kubernetes api</li>
<li>Defined an Informer that would watch node object changes, and execute callback function once that happens</li>
<li>Implemented an actual logic in the callback definition.</li>
<li>Tested the code by running the binary in outside of cluster, and then deployed it inside the cluster</li>
</ul>
<p>If you have any comments or questions on the topic, please feel free to share them with <a href="https://twitter.com/Lemonjet">me</a> !</p>
<p>&nbsp;</p>
<p><a href="http://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar.png"><img class="alignleft wp-image-1302 size-thumbnail" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar-150x150.png" alt="Avatar" width="150" height="150" data-lazy-srcset="https://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar-150x150.png 150w, https://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar-300x300.png 300w, https://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar-100x100.png 100w, https://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar.png 400w" data-lazy-sizes="(max-width: 150px) 100vw, 150px" /><noscript><img class="alignleft wp-image-1302 size-thumbnail" src="http://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar-150x150.png" alt="Avatar" width="150" height="150" srcset="https://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar-150x150.png 150w, https://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar-300x300.png 300w, https://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar-100x100.png 100w, https://cdn.rancher.com/wp-content/uploads/2015/04/21135821/Avatar.png 400w" sizes="(max-width: 150px) 100vw, 150px" /></noscript></a>Alena Prokharchyk</p>
<p>twitter: @lemonjet</p>
<p>github: https://github.com/alena1108</p>
<div class="addtoany_share_save_container addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_24 addtoany_list" data-a2a-url="https://rancher.com/using-kubernetes-api-go-kubecon-2017-session-recap/" data-a2a-title="Using Kubernetes API from Go: Kubecon 2017 session recap"><a href="https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap', '');" class="a2a_button_twitter"  title="Twitter" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/hacker_news?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap', '');" class="a2a_button_hacker_news"  title="Hacker News" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap', '');" class="a2a_button_linkedin"  title="LinkedIn" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap', '');" class="a2a_button_google_plus"  title="Google+" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap', '');" class="a2a_button_reddit"  title="Reddit" rel="nofollow noopener" target="_blank"></a><a href="https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap" onclick="__gaTracker('send', 'event', 'outbound-article', 'https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Francher.com%2Fusing-kubernetes-api-go-kubecon-2017-session-recap%2F&amp;linkname=Using%20Kubernetes%20API%20from%20Go%3A%20Kubecon%202017%20session%20recap', '');" class="a2a_button_facebook"  title="Facebook" rel="nofollow noopener" target="_blank"></a></div></div>
                  <hr>
              
              <ul class="pager">
                                                  <li class="next"><a href="?paged=2" title="Next Page">Next &rarr;</a></li>
                              </ul>

          
        </div>

        <div class="col-sm-4 col-xs-12 rnchr-left-sidebar">
          			            <div class="bottom-spacer widget">            <h4><a href="https://rancher.com/events">Upcoming Events</a></h4><hr>                                                                                                                                                                                            <ul class="list-unstyled">
                                                                                        <li>
                                <p>
                                                                    <span class="post-date bg-lightTeal">May 02, 2018 </span>
                                                                </p>
                                <div class="row">
                                    <div class="col-xs-4">
                                                                                <p style="margin-bottom: 0;"><img src="https://cdn.rancher.com/wp-content/uploads/2018/03/22132139/Screen-Shot-2018-03-22-at-1.20.30-PM-300x167.png" class="center-block img-responsive p0" alt="Kubecon + CloudNativeCon 2018"></p>
                                    </div>
                                    <div class="col-xs-8">
                                      <p style="margin-top: 0;"><a href="https://rancher.com/event/kubecon-2018/">Kubecon + CloudNativeCon 2018</a></p>
                                      <p class="small">
                                                                                      Location: Copenhagen, Denmark <br>
                                                                                                                          </p>
                                    </div>
                                </div>
                            </li>
                                                                                                <li>
                                <p>
                                                                    <span class="post-date bg-lightTeal">May 03, 2018 </span>
                                                                </p>
                                <div class="row">
                                    <div class="col-xs-4">
                                                                                <p style="margin-bottom: 0;"><img src="https://cdn.rancher.com/wp-content/uploads/2018/03/22132139/Screen-Shot-2018-03-22-at-1.20.30-PM-300x167.png" class="center-block img-responsive p0" alt="Writing Kubernetes Controllers for CRDs: Challenges, Approaches and Solutions by Alena Prokharchyk"></p>
                                    </div>
                                    <div class="col-xs-8">
                                      <p style="margin-top: 0;"><a href="https://rancher.com/event/writing-kubernetes-controllers-crds-challenges-approaches-solutions-alena-prokharchyk/">Writing Kubernetes Controllers for CRDs: Challenges, Approaches and Solutions by Alena Prokharchyk</a></p>
                                      <p class="small">
                                                                                      Location: Copenhagen, Denmark <br>
                                                                                                                                <a href="https://events.linuxfoundation.org/events/kubecon-cloudnativecon-europe-2018/program/schedule/" target="_blank">Event link<i class="fa fa-external-link text-muted left-spacer" aria-hidden="true"></i>
</a> <br>
                                                                                </p>
                                    </div>
                                </div>
                            </li>
                                                                                                <li>
                                <p>
                                                                    <span class="post-date bg-lightTeal">Jun 18, 2018 </span>
                                                                </p>
                                <div class="row">
                                    <div class="col-xs-4">
                                                                                <p style="margin-bottom: 0;"><img src="https://cdn.rancher.com/wp-content/uploads/2018/03/29160438/containerdays-logo-smaller-300x125.png" class="center-block img-responsive p0" alt="ContainerDays 2018"></p>
                                    </div>
                                    <div class="col-xs-8">
                                      <p style="margin-top: 0;"><a href="https://rancher.com/event/containerdays-2018/">ContainerDays 2018</a></p>
                                      <p class="small">
                                                                                      Location: Hamburg, Germany <br>
                                                                                                                                <a href="https://containerdays.io/" target="_blank">Event link<i class="fa fa-external-link text-muted left-spacer" aria-hidden="true"></i>
</a> <br>
                                                                                </p>
                                    </div>
                                </div>
                            </li>
                                                                        </ul>


            </div>                <div class="bottom-spacer widget">    <h4><a href="https://rancher.com/blog">Recent Posts</a></h4><hr>    <ul class="list-unstyled">
              <li>
          <p>
                    </p>
          <p><a href="https://rancher.com/project-longhorn-now-available-kubernetes/">Project Longhorn Now Available on Kubernetes</a></p>
          <p>Since we announced Project Longhorn last year, there has been&#8230; <a href="https://rancher.com/project-longhorn-now-available-kubernetes/">Read more</a></p>

        </li>
              <li>
          <p>
                    </p>
          <p><a href="https://rancher.com/adding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2/">Adding custom nodes to your Kubernetes cluster in Rancher 2.0 Tech Preview 2</a></p>
          <p>Recently, we announced our second milestone release of Rancher 2.0 Tech Preview&#8230; <a href="https://rancher.com/adding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2/">Read more</a></p>

        </li>
              <li>
          <p>
                    </p>
          <p><a href="https://rancher.com/drone-vs-jenkins/">CICD Debates: Drone vs Jenkins</a></p>
          <p>Introduction Jenkins has been the industry standard CI tool for&#8230; <a href="https://rancher.com/drone-vs-jenkins/">Read more</a></p>

        </li>
              <li>
          <p>
                    </p>
          <p><a href="https://rancher.com/announcing-rancher-2-0-tech-preview-2/">Announcing Rancher 2.0 Tech Preview 2</a></p>
          <p>Today we released the second tech preview of Rancher 2.0,&#8230; <a href="https://rancher.com/announcing-rancher-2-0-tech-preview-2/">Read more</a></p>

        </li>
              <li>
          <p>
                    </p>
          <p><a href="https://rancher.com/using-kubernetes-api-go-kubecon-2017-session-recap/">Using Kubernetes API from Go: Kubecon 2017 session recap</a></p>
          <p>Last month I had the great pleasure of attending Kubecon&#8230; <a href="https://rancher.com/using-kubernetes-api-go-kubecon-2017-session-recap/">Read more</a></p>

        </li>
          </ul>
    </div>        </div>
      </div>
      
    </div>
    
  </div>
  
</div>


<div class="rnchr-footer-2">
  
  <div class="bg-darkestGrayTwo">
    <div class="row homepage-newsletters">
      <div class="col-xs-12">
        <p>Get the latest news and offers</p>
      </div>
      <div class="col-sm-6 col-sm-offset-3">
        <div class="rnchr-hbspt-form">
          <!--[if lte IE 8]>
          <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
          <![endif]-->
          <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
          <script>
            hbspt.forms.create({ 
              css: '',
              portalId: '468859',
              formId: '8beed251-ecf0-49fc-93a1-fa9b1446110f'
            });
          </script>
        </div>
      </div>
    </div> <!-- /.homepage-newsletters -->
  </div> <!-- /.bg-navyTwo -->


  <div class="bg-midGrayTwo homepage-footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-6 nav-copyright">
                    <ul id="menu-footer" class="list-inline"><li id="menu-item-14151" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14151"><a title="About Rancher Labs" href="https://rancher.com/about/">About Rancher Labs</a></li>
<li id="menu-item-11352" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11352"><a title="Contact" href="https://rancher.com/contact/">Contact</a></li>
<li id="menu-item-14152" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14152"><a title="Privacy" href="https://rancher.com/privacy/">Privacy</a></li>
<li id="menu-item-15635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-15635"><a title="Careers" href="https://rancher.com/careers/">Careers</a></li>
</ul>          <p>&copy; 2015-2018 Rancher Labs, Inc. All Rights Reserved.</p>
        </div>
        <div class="col-sm-6 social">
          <ul class="list-inline">
            <li><a href="https://github.com/rancher/rancher" target="_blank"><img src="https://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-github.png" alt="Rancher Labs GitHub"></a></li>
            <li><a href="https://twitter.com/Rancher_Labs" target="_blank"><img src="https://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-twitter.png" alt="Rancher Labs Twitter"></a></li>
            <li><a href="https://slack.rancher.io/" target="_blank"><img src="https://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-slack.png" alt="Rancher Labs Slack"></a></li>
            <li><a href="https://www.linkedin.com/groups/6977008/profile" target="_blank"><img src="https://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-linkedin.png" alt="Rancher Labs LinkedIn"></a></li>
            <li><a href="https://www.facebook.com/rancherlabs/" target="_blank"><img src="https://rancher.com/wp-content/themes/rancher-2016/assets/images/social-white-fb.png" alt="Rancher Labs Facebook"></a></li>
            
          </ul>
        </div>
      </div>
    </div> <!-- /.container -->
  </div> <!-- /.homepage-footer -->
</div>


<!-- Start of Async HubSpot Analytics Code for WordPress v1.9.4 -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
(function(d,s,i,r) {
  if (d.getElementById(i)){return;}
  var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
  n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/468859.js';
  e.parentNode.insertBefore(n, e);
})(document, "script", "hs-analytics", 300000);
</script>
<!-- End of Async HubSpot Analytics Code -->
<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/rancher.com\/wp-json\/","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://rancher.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.8'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var tocplus = {"visibility_show":"show","visibility_hide":"hide","width":"Auto"};
/* ]]> */
</script>
<script type='text/javascript' src='https://rancher.com/wp-content/plugins/table-of-contents-plus/front.min.js?ver=1509'></script>
<script type='text/javascript' src='https://rancher.com/wp-includes/js/wp-embed.min.js?ver=4.8.5'></script>

</body>
</html>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 <h2><a href="https://rancher.com/adding-custom-nodes-kubernetes-cluster-rancher-2-0-tech-preview-2/">Adding custom nodes to your Kubernetes cluster in Rancher 2.0 Tech Preview 2</a></h2>
 
 
 
 <p>The agent image can be retrieved from the <code>settings</code> endpoint in the API:</p>
<pre>AGENTIMAGE=`curl -s -H "Authorization: Bearer $APITOKEN" <a href="https://medium.com/r/?url=https%3A%2F%2F127.0.0.1%2Fv3%2Fsettings%2Fagent-image" target="_blank" rel="nofollow noopener">https://127.0.0.1/v3/settings/agent-image</a> --insecure | jq -r .value`</pre>
<p>The roles for the node, you can decide for yourself. (For this example, we’ll be using all three roles):</p>
<pre>ROLEFLAGS="--etcd --controlplane --worker"</pre>
<p>The address where the <code>rancher/server</code> container can be reached, should be self explanatory. The <code>rancher/agent</code> will connect to that endpoint.</p>
<pre>RANCHERSERVER="https://rancher_server_address"</pre>
<p>The cluster token can be retrieved from the created cluster. We saved the created clusterid in <code>CLUSTERID</code> , which we can now use to generate a token.</p>
<pre># Generate token (clusterRegistrationToken)
AGENTTOKEN=`curl -s 'https://127.0.0.1/v3/clusterregistrationtoken' -H 'content-type: application/json' -H "Authorization: Bearer $APITOKEN" --data-binary '{"type":"clusterRegistrationToken","clusterId":"'$CLUSTERID'"}' --insecure | jq -r .token`</pre>
<p>The generated CA certificate is stored in the API as well, and can be retrieved as shown below. We append <code>sha256sum</code> to generate the checksum we need to join the cluster.</p>
<pre># Retrieve CA certificate and generate checksum
CACHECKSUM=`curl -s -H "Authorization: Bearer $APITOKEN" https://127.0.0.1/v3/settings/cacerts --insecure | jq -r .value | sha256sum | awk '{ print $1 }'`</pre>
<p>All data needed to join the cluster is now available, we only need to assemble the command.</p>
<pre># Assemble the docker run command
AGENTCOMMAND="docker run -d --restart=unless-stopped -v /var/run/docker.sock:/var/run/docker.sock --net=host $AGENTIMAGE $ROLEFLAGS --server $RANCHERSERVER --token $AGENTTOKEN --ca-checksum $CACHECKSUM"</pre>
<pre># Show the command
echo $AGENTCOMMAND</pre>
  
  
  
  Emphasis, aka italics, with *asterisks* or _underscores_.

Emphasis, aka italics, with *asterisks* or _underscores_.

       Strong emphasis, aka bold, with **asterisks** or __underscores__.

Strong emphasis, aka bold, with **asterisks** or __underscores__.

      Combined emphasis with **asterisks and _underscores_**.

Combined emphasis with **asterisks and _underscores_**.


Strikethrough uses two tildes. ~~Scratch this.~~


# H1
## H2
### H3
#### H4
##### H5
###### H6

Alternatively, for H1 and H2, an underline-ish style:

Alt-H1
======

Alt-H2
------










<a href="https://github.com/rickalouani/Rancher-howto/blob/master/Rancher-screen-shots/microservice1.png
" target="_blank"><img src="https://github.com/rickalouani/Rancher-howto/blob/master/Rancher-screen-shots/microservice1.png" 
alt="IMAGE ALT TEXT HERE" width="540" height="320" border="50" /></a>






> This is a very long line that will still be quoted properly when it wraps. Oh boy let's keep writing to make sure this is long enough to actually wrap for everyone. Oh, you can *put* **Markdown** into a blockquote.  
  
  
  
  
  
  
  
  
  Colons can be used to align columns.

    | Tables        | Are           | Cool  |
    | ------------- |:-------------:| -----:|
    | col 3 is      | right-aligned | $1600 |
    | col 2 is      | centered      |   $12 |
    | zebra stripes | are neat      |    $1 |




Colons can be used to align columns.

| Micro-services Core Needs             |          Kubernetes offerings   |
| --------------------------------------|:-------------------------------:|
| col 3 is                              |                                 |  
| 
Markdown | Less | Pretty
--- | --- | ---
*Still* | `renders` | **nicely**
1 | 2 | 3







Here's our logo (hover to see the title text):

    Inline-style: 
    ![alt text](https://github.com/adam-p/markdown-here/raw/master/src/common/images/icon48.png "Logo Title Text 1")

Inline-style: 
    ![alt text](https://github.com/rickalouani/Rancher-howto/blob/master/Rancher-screen-shots/10000-12.png "Logo Title Text 1")
    
    
    Reference-style: 
    ![alt text][logo]

    [logo]: https://github.com/rickalouani/Rancher-howto/blob/master/Rancher-screen-shots/10000-6.png "Logo Title Text 2"


Reference-style: 
![alt text][logo]

[logo]: https://github.com/rickalouani/Rancher-howto/blob/master/Rancher-screen-shots/10000-6.png "Microservices"




      1. [I'm an inline-style link](https://www.google.com)
[I'm an inline-style link](https://www.google.com)

     2. [I'm an inline-style link with title](https://www.google.com "Google's Homepage")
     
[I'm an inline-style link with title](https://www.google.com "Google's Homepage")

     3. [I'm a reference-style link][Arbitrary case-insensitive reference text]
     
[I'm a reference-style link][Arbitrary case-insensitive reference text]
     
     
     4. [I'm a relative reference to a repository file](../blob/master/LICENSE) 

[I'm a relative reference to a repository file](../blob/master/LICENSE)

     5. [You can use numbers for reference-style link definitions][1]
 
[You can use numbers for reference-style link definitions][1]

    6. [You can use numbers for reference-style link definitions][1]
    
[You can use numbers for reference-style link definitions][1]


Or leave it empty and use the [link text itself].

URLs and URLs in angle brackets will automatically get turned into links. 
http://www.example.com or <http://www.example.com> and sometimes 
example.com (but not on Github, for example).

Some text to show that the reference links can follow later.

[arbitrary case-insensitive reference text]: https://www.mozilla.org
[1]: http://slashdot.org
[link text itself]: http://www.reddit.com
